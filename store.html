<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Ricambi - Car's world</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding-top: 80px; }
        .container { max-width: 600px; margin: auto; padding: 15px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        
        header { position: fixed; top: 0; left: 0; right: 0; height: 60px; background: #ff9800; color: white; display: flex; align-items: center; justify-content: center; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h1 { font-size: 22px; text-transform: uppercase; margin: 0; }
        
        #search-ricambi { width: 100%; max-width: 500px; padding: 15px; border-radius: 12px; border: 2px solid #ff9800; margin-bottom: 20px; outline: none; font-size: 16px; box-sizing: border-box; }
        
        .product-card { background: white; width: 100%; max-width: 500px; padding: 15px; margin-bottom: 10px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; box-sizing: border-box; gap: 15px; text-align: left; }
        .product-img { width: 70px; height: 70px; border-radius: 8px; object-fit: cover; background: #eee; }
        .product-info { flex-grow: 1; }
        .product-info h4 { margin: 0; color: #333; font-size: 17px; }
        .product-info p { margin: 5px 0 0; color: #666; font-size: 14px; }
        .price { font-weight: bold; color: #ff9800; font-size: 18px; margin-right: 10px; }

        .btn-add { background: #4caf50; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px; transition: 0.3s; }
        .btn-add:hover { background: #45a049; }

        #carrello-box { width: 100%; max-width: 500px; background: #fff; padding: 20px; border-radius: 15px; margin-top: 20px; border: 2px dashed #ff9800; box-sizing: border-box; }
        .carrello-item { display: flex; justify-content: space-between; align-items: center; font-size: 14px; margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .btn-remove { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; }

        #modulo-preventivo { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 15px; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); box-sizing: border-box; margin-bottom: 40px; }
        #modulo-preventivo h3 { margin-top: 0; color: #ff9800; margin-bottom: 20px; }
        
        .sezione-form { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; border: 1px solid #eee; }
        .sezione-form label { font-size: 12px; font-weight: bold; color: #666; text-transform: uppercase; display: block; margin-bottom: 5px; }

        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-family: inherit; font-size: 15px; }
        
        .btn-invia { background: #ff9800; color: white; padding: 18px; width: 100%; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 16px; transition: 0.3s; }
        .btn-invia:hover { background: #e68a00; transform: translateY(-2px); }
        
        .back-home { margin-top: 10px; display: inline-block; text-decoration: none; color: #666; font-weight: bold; font-size: 14px; padding-bottom: 30px; }

        .hidden { display: none; }
    </style>
</head>
<body>
    <header><h1>Store Ricambi</h1></header>

    <div class="container">
        <input type="text" id="search-ricambi" placeholder="üîç Cerca tra i ricambi..." onkeyup="filterProducts()">

        <div id="lista-prodotti" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <div class="product-card">
                <img src="img/spazzole.jpg" class="product-img" alt="foto">
                <div class="product-info"><h4>Spazzole Tergicristallo</h4><p>Coppia anteriore</p></div>
                <div class="price">25.00‚Ç¨</div>
                <button class="btn-add" onclick="aggiungiCarrello('Spazzole Tergicristallo', 25.00)">AGGIUNGI</button>
            </div>
            <div class="product-card">
                <img src="img/batteria.jpg" class="product-img" alt="foto">
                <div class="product-info"><h4>Batteria 60Ah</h4><p>Alta resistenza</p></div>
                <div class="price">75.00‚Ç¨</div>
                <button class="btn-add" onclick="aggiungiCarrello('Batteria 60Ah', 75.00)">AGGIUNGI</button>
            </div>
        </div>

        <div id="carrello-box">
            <h3>üõí Il tuo carrello</h3>
            <div id="lista-carrello"><p style="color: #999; font-size: 13px;">Nessun prodotto selezionato.</p></div>
            <div id="box-totale" style="display:none; margin-top:10px; font-weight:bold; border-top:1px solid #333; padding-top:5px; font-size: 20px;">
                TOTALE: <span id="valore-totale">0</span>‚Ç¨
            </div>
        </div>

        <div id="modulo-preventivo">
            <h3>Dati per la Fatturazione e Spedizione</h3>
            <form action="https://formspree.io/f/tuocodice" method="POST" onsubmit="confermaOrdine()">
                
                <div class="sezione-form">
                    <label>Tipo Cliente</label>
                    <select name="tipo_cliente" id="tipo_cliente" onchange="switchCampiFatturazione()" required>
                        <option value="Privato">Privato</option>
                        <option value="Ditta">Azienda / Libero Professionista</option>
                    </select>
                </div>

                <div id="campi-privato">
                    <input type="text" name="nome_cognome" placeholder="Nome e Cognome" id="input_nome">
                    <input type="text" name="codice_fiscale" placeholder="Codice Fiscale" id="input_cf">
                </div>

                <div id="campi-ditta" class="hidden">
                    <input type="text" name="ragione_sociale" placeholder="Ragione Sociale" id="input_ragione">
                    <input type="text" name="partita_iva" placeholder="Partita IVA" id="input_piva">
                    <input type="text" name="codice_univoco_pec" placeholder="Codice Univoco o PEC" id="input_sdi">
                </div>

                <div class="sezione-form">
                    <label>Indirizzi e Contatto Corriere</label>
                    <textarea name="indirizzo_fatturazione" placeholder="Indirizzo di Fatturazione completo" required></textarea>
                    <textarea name="indirizzo_spedizione" placeholder="Indirizzo di Spedizione (Scrivi 'Come fatturazione' se uguale)" required></textarea>
                    <input type="tel" name="telefono_corriere" placeholder="Cellulare per il corriere (Obbligatorio)" required>
                </div>

                <div class="sezione-form">
                    <label>Dati Veicolo</label>
                    <input type="text" name="targa" placeholder="Targa del veicolo (Fondamentale)" required>
                </div>

                <div class="sezione-form">
                    <label>Pagamento e Contatto Rapido</label>
                    <select name="metodo_pagamento" id="metodo_pagamento" onchange="mostraCarrello()" required>
                        <option value="Bonifico">Bonifico (Prezzo standard)</option>
                        <option value="Contrassegno">Contrassegno (+5.00‚Ç¨)</option>
                    </select>
                    <select name="mezzo_contatto_preferito" required>
                        <option value="WhatsApp">Ricontattami su WhatsApp</option>
                        <option value="Email">Ricontattami via Email</option>
                        <option value="Chiamata">Chiamata Telefonica</option>
                    </select>
                    <input type="text" name="recapito_veloce" placeholder="Numero o Email per conferma ordine" required>
                </div>

                <textarea id="ordine-testo" name="riepilogo_carrello" class="hidden"></textarea>
                
                <button type="submit" class="btn-invia">Invia Ordine</button>
            </form>
        </div>
        
        <a href="index.html" class="back-home">‚Üê Torna alla Home</a>
    </div>

    <script>
        let carrello = [];
        let totaleProdotti = 0;

        function switchCampiFatturazione() {
            const tipo = document.getElementById('tipo_cliente').value;
            const isPrivato = (tipo === 'Privato');
            
            document.getElementById('campi-privato').classList.toggle('hidden', !isPrivato);
            document.getElementById('campi-ditta').classList.toggle('hidden', isPrivato);

            // Rende i campi obbligatori solo se visibili
            document.getElementById('input_nome').required = isPrivato;
            document.getElementById('input_cf').required = isPrivato;
            document.getElementById('input_ragione').required = !isPrivato;
            document.getElementById('input_piva').required = !isPrivato;
            document.getElementById('input_sdi').required = !isPrivato;
        }
        // Avvio iniziale per settare i required corretti
        switchCampiFatturazione();

        function confermaOrdine() {
            alert("Ordine effettuato! Verificheremo la compatibilit√† dei pezzi tramite la targa e ti contatteremo a breve per la conferma finale.");
        }

        function aggiungiCarrello(nome, prezzo) {
            carrello.push({nome, prezzo});
            totaleProdotti += prezzo;
            mostraCarrello();
        }

        function rimuoviDalCarrello(index) {
            totaleProdotti -= carrello[index].prezzo;
            carrello.splice(index, 1);
            mostraCarrello();
        }

        function mostraCarrello() {
            let lista = document.getElementById('lista-carrello');
            let boxTotale = document.getElementById('box-totale');
            let areaTesto = document.getElementById('ordine-testo');
            let metodoPagamento = document.getElementById('metodo_pagamento').value;

            if (carrello.length === 0) {
                lista.innerHTML = '<p style="color: #999;">Nessun prodotto selezionato.</p>';
                boxTotale.style.display = "none";
                areaTesto.value = "";
                return;
            }

            lista.innerHTML = "";
            let testoRiepilogo = "RIEPILOGO PRODOTTI:\n";
            carrello.forEach((item, i) => {
                lista.innerHTML += `<div class="carrello-item"><span>${item.nome}</span><span>${item.prezzo.toFixed(2)}‚Ç¨ <button class="btn-remove" onclick="rimuoviDalCarrello(${i})">X</button></span></div>`;
                testoRiepilogo += `- ${item.nome} (${item.prezzo.toFixed(2)}‚Ç¨)\n`;
            });

            let supplemento = (metodoPagamento === "Contrassegno") ? 5.0 : 0;
            let totaleFinale = totaleProdotti + supplemento;

            if (supplemento > 0) {
                lista.innerHTML += `<div class="carrello-item" style="color:red; font-weight:bold;"><span>Supplemento Contrassegno</span><span>+5.00‚Ç¨</span></div>`;
            }

            document.getElementById('valore-totale').innerText = totaleFinale.toFixed(2);
            boxTotale.style.display = "block";
            areaTesto.value = testoRiepilogo + "\nTOTALE ORDINE: " + totaleFinale.toFixed(2) + "‚Ç¨\nMETODO SCELTO: " + metodoPagamento;
        }

        function filterProducts() {
            let input = document.getElementById('search-ricambi').value.toLowerCase();
            let cards = document.getElementsByClassName('product-card');
            for (let card of cards) {
                card.style.display = card.textContent.toLowerCase().includes(input) ? "flex" : "none";
            }
        }
    </script>
</body>
</html>
