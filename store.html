<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Ricambi - Car's world</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding-top: 80px; }
        
        /* HEADER E BOTTONE CARRELLO */
        header { position: fixed; top: 0; left: 0; right: 0; height: 60px; background: #ff9800; color: white; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h1 { font-size: 20px; text-transform: uppercase; margin: 0; }
        
        .btn-apri-carrello { background: white; color: #ff9800; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; }

        .container { max-width: 650px; margin: auto; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        #search-ricambi { width: 100%; max-width: 500px; padding: 15px; border-radius: 12px; border: 2px solid #ff9800; margin-bottom: 20px; outline: none; font-size: 16px; box-sizing: border-box; }
        
        /* LAYOUT PRODOTTI RIFINITO */
        .product-card { background: white; width: 100%; padding: 15px; margin-bottom: 12px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: flex-start; box-sizing: border-box; gap: 15px; }
        .product-img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; }
        .product-info { flex-grow: 1; text-align: left; }
        .product-info h4 { margin: 0; color: #333; font-size: 17px; }
        .product-info p { margin: 5px 0 10px 0; color: #666; font-size: 14px; line-height: 1.3; }
        
        .right-side { text-align: right; display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between; min-width: 100px; min-height: 80px; }
        .price { font-weight: bold; color: #ff9800; font-size: 18px; margin-bottom: 5px; }
        .btn-add { background: #4caf50; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 11px; text-transform: uppercase; width: 100%; }

        .preventivo-rapido { background: #333; color: white; width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; margin-top: 40px; margin-bottom: 30px; box-sizing: border-box; text-align: left; }
        .preventivo-rapido h3 { margin-top: 0; color: #ff9800; }
        .preventivo-rapido p { font-size: 13px; color: #ccc; margin-bottom: 15px; }

        /* LIVELLO CARRELLO FULL PAGE */
        #overlay-carrello { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 20000; overflow-y: auto; display: none; }
        .carrello-content { max-width: 600px; margin: 20px auto; padding: 20px; }
        .header-carrello { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ff9800; padding-bottom: 10px; margin-bottom: 20px; }
        .btn-chiudi { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        .carrello-vuoto { color: #999; padding: 40px 0; text-align: center; }
        .carrello-item { background: white; padding: 10px 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-remove { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        .sezione-form { background: white; padding: 20px; border-radius: 12px; margin-top: 20px; text-align: left; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .sezione-form h3 { margin-top: 0; color: #ff9800; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 15px; }
        
        .riepilogo-finale-box { background: #fff3e0; padding: 20px; border-radius: 12px; border: 2px solid #ff9800; margin: 20px 0; text-align: right; }
        .totale-grande { font-size: 24px; font-weight: bold; color: #e65100; }

        .btn-invia { background: #ff9800; color: white; padding: 20px; width: 100%; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 18px; box-shadow: 0 4px 15px rgba(255,152,0,0.3); }

        .hidden { display: none; }
        .back-home { margin: 20px 0; text-decoration: none; color: #666; font-weight: bold; }

        #msg-conferma { display: none; background: #4caf50; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-weight: bold; }

        footer { background: #333; color: white; padding: 40px 20px; margin-top: 50px; text-align: center; font-size: 14px; width: 100%; box-sizing: border-box; }
        .footer-container { max-width: 650px; margin: auto; text-align: left; }
    </style>
</head>
<body>

    <header>
        <h1>Car's World</h1>
        <button class="btn-apri-carrello" onclick="toggleCarrello(true)">
            üõí CARRELLO (<span id="count-cart">0</span>)
        </button>
    </header>

    <div class="container">
        
        <input type="text" id="search-ricambi" placeholder="üîç Cerca tra i ricambi pronti..." onkeyup="filterProducts()">

        <div id="lista-prodotti" style="width: 100%;">
            <div class="product-card">
                <img src="img/spazzole.jpg" class="product-img" alt="foto">
                <div class="product-info">
                    <h4>Spazzole Tergicristallo</h4>
                    <p>Coppia di spazzole anteriori ad alta visibilit√†, compatibili con attacchi originali.</p>
                </div>
                <div class="right-side">
                    <div class="price">25.00‚Ç¨</div>
                    <button class="btn-add" onclick="aggiungiCarrello('Spazzole Tergicristallo', 25.00)">+ Aggiungi</button>
                </div>
            </div>

            <div class="product-card">
                <img src="img/batteria.jpg" class="product-img" alt="foto">
                <div class="product-info">
                    <h4>Batteria 60Ah</h4>
                    <p>Batteria 12V 60Ah con spunto maggiorato per partenze sicure in ogni condizione climatica.</p>
                </div>
                <div class="right-side">
                    <div class="price">75.00‚Ç¨</div>
                    <button class="btn-add" onclick="aggiungiCarrello('Batteria 60Ah', 75.00)">+ Aggiungi</button>
                </div>
            </div>
        </div>

        <div class="preventivo-rapido">
            <h3>Non trovi il tuo ricambio?</h3>
            <p>Inviaci i dati e ti risponderemo con un preventivo personalizzato.</p>
            
            <div id="msg-conferma">Richiesta inviata correttamente!</div>

            <form id="form-preventivo" action="https://formspree.io/f/mlgdkage" method="POST" onsubmit="resetPreventivo()">
                <input type="text" name="nome_contatto" placeholder="Il tuo Nome" required>
                <select name="preferenza_contatto" required>
                    <option value="" disabled selected>Come vuoi essere contattato?</option>
                    <option value="WhatsApp">WhatsApp</option>
                    <option value="Email">E-mail</option>
                </select>
                <input type="text" name="recapito" placeholder="Inserisci Numero o Email" required>
                <input type="text" name="targa_richiesta" placeholder="Targa del veicolo" required>
                <textarea name="ricambio_cercato" placeholder="Quale ricambio stai cercando?" style="height: 80px;" required></textarea>
                <p style="font-size: 11px; color: #888; margin-bottom: 10px;">* I dati saranno utilizzati solo per l'invio del preventivo richiesto.</p>
                <button type="submit" class="btn-invia" style="padding: 12px; font-size: 14px;">Richiedi Preventivo</button>
            </form>
            <p style="text-align: center; font-size: 13px; margin-top: 15px; color: #ff9800;">Per assistenza mandare un‚Äôe-mail all‚Äôindirizzo 996maral@gmail.com</p>
        </div>
        
        <a href="index.html" class="back-home">‚Üê Torna alla Home</a>
    </div>

    <footer>
        <div class="footer-container">
            <h3 style="color: #ff9800; margin-top: 0;">Car's World - Store Online</h3>
            <p><strong>Assistenza Clienti:</strong> Specialisti in Ricambi Auto - Vendita e Consulenza Tecnica Online</p>
            <hr style="border: 0; border-top: 1px solid #555; margin: 20px 0;">
            <p><strong>Cosa devi sapere:</strong></p>
            <ul style="list-style-type: none; padding: 0; line-height: 1.6; color: #bbb;">
                <li>üöö <strong>Spedizioni:</strong> Consegna tramite corriere in 3-5 giorni lavorativi con codice di tracking.</li>
                <li>üì¶ <strong>Resi:</strong> Il cliente ha diritto al recesso entro 14 giorni dalla consegna del prodotto.</li>
                <li>üí≥ <strong>Pagamenti:</strong> Accettiamo Bonifico Bancario o Contrassegno (pagamento alla consegna).</li>
                <li>üîç <strong>Compatibilit√†:</strong> Per i preventivi personalizzati, la compatibilit√† √® verificata tramite targa dal nostro staff.</li>
            </ul>
            <p style="text-align: center; color: #888; margin-top: 20px; font-size: 12px;">&copy; 2026 Car's World - Store Ricambi Online</p>
        </div>
    </footer>

    <div id="overlay-carrello">
        <div class="carrello-content">
            <div class="header-carrello">
                <h2>Riepilogo Ordine</h2>
                <button class="btn-chiudi" onclick="toggleCarrello(false)">Chiudi ‚úï</button>
            </div>

            <div id="lista-carrello-full">
                <div class="carrello-vuoto">Il tuo carrello √® attualmente vuoto.</div>
            </div>

            <div id="modulo-completo" class="hidden">
                <form action="https://formspree.io/f/mlgdkage" method="POST">
                    
                    <div class="sezione-form">
                        <h3>1. Dati Fatturazione</h3>
                        <select name="tipo_cliente" id="tipo_cliente" onchange="switchFatt()">
                            <option value="Privato">Privato</option>
                            <option value="Azienda">Azienda</option>
                        </select>
                        <div id="box-privato">
                            <input type="text" name="nome" placeholder="Nome e Cognome" required>
                            <input type="text" name="cf" placeholder="Codice Fiscale" required>
                        </div>
                        <div id="box-ditta" class="hidden">
                            <input type="text" name="ragione_sociale" placeholder="Ragione Sociale">
                            <input type="text" name="piva" placeholder="Partita IVA">
                            <input type="text" name="sdi" placeholder="Codice SDI o PEC">
                        </div>
                        <textarea name="ind_fatturazione" id="ind_fatt" placeholder="Indirizzo di fatturazione" required onkeyup="syncSped()"></textarea>
                    </div>

                    <div class="sezione-form">
                        <h3>2. Spedizione e Contatti</h3>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <input type="checkbox" id="check_uguale" onclick="syncSped()" style="width:auto; margin:0;">
                            <label for="check_uguale" style="font-size:14px;">Spedizione uguale alla fatturazione</label>
                        </div>
                        <textarea name="ind_spedizione" id="ind_sped" placeholder="Indirizzo di spedizione" required></textarea>
                        <input type="tel" name="telefono" placeholder="Cellulare per il corriere (Facoltativo)">
                    </div>

                    <div class="sezione-form">
                        <h3>3. Metodo di Pagamento</h3>
                        <select name="pagamento" id="metodo_pag" onchange="aggiornaPrezzi()">
                            <option value="Bonifico">Bonifico Bancario</option>
                            <option value="Contrassegno">Contrassegno (+5.00‚Ç¨)</option>
                        </select>
                    </div>

                    <div class="riepilogo-finale-box">
                        <div>Imponibile: <span id="res-imponibile">0.00</span>‚Ç¨</div>
                        <div>IVA (22%): <span id="res-iva">0.00</span>‚Ç¨</div>
                        <div id="res-extra" class="hidden" style="color:red;">Supplemento Contrassegno: 5.00‚Ç¨</div>
                        <div class="totale-grande">TOTALE: <span id="res-totale">0.00</span>‚Ç¨</div>
                    </div>

                    <input type="hidden" name="ordine_dettagliato" id="hidden_ordine">
                    <button type="submit" class="btn-invia">Invia Ordine</button>
                    <p style="text-align: center; font-size: 13px; margin-top: 15px; color: #666;">Per assistenza mandare un‚Äôe-mail all‚Äôindirizzo 996maral@gmail.com</p>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Carica dati dal localStorage all'avvio
        let carrello = JSON.parse(localStorage.getItem('carrello_carsworld')) || [];
        let sommaLorda = 0;

        // Inizializza la pagina basandosi sulla memoria caricata
        window.onload = function() {
            aggiornaPrezzi();
        }

        // FUNZIONE RESET MODULO PREVENTIVO
        function resetPreventivo() {
            const form = document.getElementById('form-preventivo');
            const msg = document.getElementById('msg-conferma');
            
            // Ritardo per permettere l'invio a Formspree
            setTimeout(() => {
                form.reset();
                msg.style.display = 'block'; // Mostra conferma
                setTimeout(() => { msg.style.display = 'none'; }, 4000); // Nasconde dopo 4 sec
            }, 500);
        }

        function toggleCarrello(show) {
            document.getElementById('overlay-carrello').style.display = show ? 'block' : 'none';
            document.body.style.overflow = show ? 'hidden' : 'auto';
        }

        function aggiungiCarrello(nome, prezzo) {
            carrello.push({nome, prezzo});
            salvaEMostra();
            alert(nome + " aggiunto al carrello!");
        }

        function rimuovi(index) {
            carrello.splice(index, 1);
            salvaEMostra();
        }

        function ricalcolaTotale() {
            sommaLorda = 0;
            carrello.forEach(item => { sommaLorda += item.prezzo; });
            document.getElementById('count-cart').innerText = carrello.length;
        }

        function salvaEMostra() {
            localStorage.setItem('carrello_carsworld', JSON.stringify(carrello));
            aggiornaPrezzi();
        }

        function aggiornaPrezzi() {
            ricalcolaTotale(); 
            
            const lista = document.getElementById('lista-carrello-full');
            const modulo = document.getElementById('modulo-completo');
            const pag = document.getElementById('metodo_pag').value;

            if(carrello.length === 0) {
                lista.innerHTML = '<div class="carrello-vuoto">Il tuo carrello √® attualmente vuoto.</div>';
                modulo.classList.add('hidden');
                document.getElementById('count-cart').innerText = "0";
                return;
            }

            modulo.classList.remove('hidden');
            lista.innerHTML = "<h3>Articoli selezionati:</h3>";
            carrello.forEach((item, i) => {
                lista.innerHTML += `<div class="carrello-item"><span>${item.nome}</span><span>${item.prezzo.toFixed(2)}‚Ç¨ <button class="btn-remove" onclick="rimuovi(${i})">X</button></span></div>`;
            });

            let extra = (pag === "Contrassegno") ? 5.0 : 0;
            let totaleSenzaIva = (sommaLorda + extra) / 1.22;
            let soloIva = (sommaLorda + extra) - totaleSenzaIva;

            document.getElementById('res-imponibile').innerText = totaleSenzaIva.toFixed(2);
            document.getElementById('res-iva').innerText = soloIva.toFixed(2);
            document.getElementById('res-totale').innerText = (sommaLorda + extra).toFixed(2);
            document.getElementById('res-extra').classList.toggle('hidden', extra === 0);
            
            document.getElementById('hidden_ordine').value = `Articoli: ${carrello.length} - Totale: ${(sommaLorda+extra).toFixed(2)}‚Ç¨`;
        }

        function switchFatt() {
            const ditta = document.getElementById('tipo_cliente').value === 'Azienda';
            document.getElementById('box-privato').classList.toggle('hidden', ditta);
            document.getElementById('box-ditta').classList.toggle('hidden', !ditta);
        }

        function syncSped() {
            const check = document.getElementById('check_uguale');
            const f = document.getElementById('ind_fatt');
            const s = document.getElementById('ind_sped');
            if(check.checked) { s.value = f.value; s.readOnly = true; s.style.background = "#eee"; }
            else { s.readOnly = false; s.style.background = "#fff"; }
        }

        function filterProducts() {
            let val = document.getElementById('search-ricambi').value.toLowerCase();
            let cards = document.getElementsByClassName('product-card');
            for(let c of cards) { c.style.display = c.innerText.toLowerCase().includes(val) ? "flex" : "none"; }
        }
    </script>
</body>
</html>
